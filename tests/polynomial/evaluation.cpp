/**
 * \file tests/polynomial/evaluation.cpp
 * \brief Unit tests for operator() of Polynomial class.
 * \author Pi-Yueh Chuang
 * \version beta
 * \date 2018-02-08
 */

# include <gtest/gtest.h>

# include "polynomial.h"

using namespace simpoly;

TEST(PolynomialEval, CoeffEvalOneValue)
{
    poly::Polynomial p({
        -0.4916218280996111911, -0.8982162617733904231, 0.7602088084916123201,
        -0.448439129531960301, 0.3545960195550776906, -0.3283898241480742719,
        0.4223789892087406184, -0.7103073755983877469, -0.3174457996772097612,
        0.5678907422064218835, 0.1017319946924333252, -0.5244753533101400578});

    basic::DArry x({
        -0.9716791891045937213, -0.9433930284794238563, -0.9285346054263321491,
        -0.9191397182627092377, -0.9157027296562816332, -0.898500881351468994 ,
        -0.8929698142612050304, -0.8658543285738298234, -0.847897629451069168 ,
        -0.8369684145024784971, -0.8190150600262362524, -0.8086860317274677801,
        -0.8028785086540657367, -0.7815357849476760599, -0.7297751701355084109,
        -0.7017546833783556703, -0.6050979157571889644, -0.5864113091735991823,
        -0.5854616115574120538, -0.5763231385482165958, -0.550982565276565639 ,
        -0.5484293822895196513, -0.5239294666950595758, -0.52271040960075843  ,
        -0.5209594989994210668, -0.5115653454454371918, -0.5061769492911230017,
        -0.4680558887398351686, -0.3514234374167519714, -0.292206542363799171 ,
        -0.2713101781213369534, -0.2610267067476770286, -0.246963041191359256 ,
        -0.2396068891679417057, -0.2115852514073548463, -0.2062164863301956252,
        -0.1795288265989700704, -0.1777880949384156306, -0.17204173366609532  ,
        -0.1640895549260288355, -0.1318854048193409678, -0.1105856171753487605,
        -0.0665137068668282261, -0.0601092627970079008, -0.0405274881966453115,
        -0.0345996065394731378, -0.0336030353860512498, -0.0268465010949860972,
        -0.0163496089306680581, -0.0030854627148424463,  0.0323466056905143962,
        0.0330141390602332052,  0.0484900535975290037,  0.0766940377157687703,
        0.0771149741561787394,  0.0883546814829068161,  0.1404273991451308046,
        0.1515555784187796462,  0.2157002647504653314,  0.3458730112580528093,
        0.3822846995618662813,  0.4023632606195630679,  0.4086336979887750243,
        0.4218642550348343789,  0.4934427320690681906,  0.5136950846603085541,
        0.5303347828052613622,  0.5352700834039478828,  0.5460565603036600102,
        0.5695242345638906745,  0.5743861793754032607,  0.5880763062326954671,
        0.5912906091507657003,  0.5993417674864114364,  0.6071473248420011792,
        0.6190650480213391038,  0.6526039510453802706,  0.657589754038739871 ,
        0.6601521832211765251,  0.6705655295638843771,  0.7015806157578881042,
        0.702016289223720058 ,  0.7119873570744936764,  0.7237036564974344   ,
        0.7293822198829045256,  0.7379276671174737068,  0.7379496340217694961,
        0.7381858238138130357,  0.7673473395688295007,  0.781437197166929387 ,
        0.7908435339730013336,  0.80350625163021272  ,  0.8153214816198517401,
        0.8548717869707775918,  0.8908864381188752457,  0.9203151386957315605,
        0.9232977159544399903,  0.9469237399574974567,  0.9712669939719409395,
        0.9885908947215498177});

    basic::DArry expect({
        2.8152080950040403451,  2.503031526316306099 ,  2.3541863437401095993,
        2.2649004228568356822,  2.2331201627814758481,  2.0807690507157827753,
        2.0340395815149339143,  1.819410808490801168 ,  1.6893169057565093905,
        1.6143766892149538084,  1.497688539980585265 ,  1.4339345721263085931,
        1.3991123244898677758,  1.2770935565935286338,  1.0155601887329379629,
        0.8914083986914540514,  0.53646856416665889  ,  0.4786410794658201295,
        0.4757818834630597182,  0.4486490161360618956,  0.3768515861215918639,
        0.3698851624236532132,  0.3053664125085201464,  0.3022624767867836404,
        0.2978213878918108959,  0.2743314790895118316,  0.2611096977549073328,
        0.1724843346484139506, -0.0542985325154361487, -0.1494060703997987516,
        -0.1803764287140802725, -0.1951644395481811345, -0.2149250890816554183,
        -0.2250540407445572044, -0.2623918850940754055, -0.2693281526496128508,
        -0.3028217500755164826, -0.3049509398421561546, -0.3119327422265886218,
        -0.3214772805899649422, -0.3587855478307607759, -0.3823294732853440014,
        -0.4283755488279765711, -0.4347816807922331717, -0.453939908370930234 ,
        -0.4596147282519900124, -0.4605631527589774121, -0.4669510895545481155,
        -0.4767311466947223852, -0.4888431648606307856, -0.5198954667706742194,
        -0.5204628151168144701, -0.533438165898329375 , -0.5562289555374462235,
        -0.5565609281020649224, -0.5653381289383850872, -0.603884217625596964 ,
        -0.6116866951102153394, -0.653857364220855608 , -0.7261779966223751437,
        -0.7436407874242593197, -0.7528307974286454485, -0.7556417043892360574,
        -0.7614859339921682402, -0.7914303655016394767, -0.7995509917860529336,
        -0.8061759981031171307, -0.8081385130258158522, -0.812431636715872818 ,
        -0.8218404586667125145, -0.823810799429267937 , -0.8294181613189255398,
        -0.8307498899050670405, -0.834115969632706511 , -0.8374264338353394344,
        -0.8425868437186154747, -0.858029068467168643 , -0.8604717961212631216,
        -0.8617448885551297622, -0.8670516003829764617, -0.8843708194080095453,
        -0.8846330096563130851, -0.8907998029826937891, -0.8984863518967065588,
        -0.9024000661008482194, -0.9085427474732965525, -0.9085589489072991576,
        -0.9087332850778911952, -0.9323877718896431688, -0.9455628915673015555,
        -0.9551055315509942023, -0.969009117169223666 , -0.983197365354386843 ,
        -1.0411003717020679282, -1.1119985585248977067, -1.1873694375621384189,
        -1.1960691479273006799, -1.2730701030408371199, -1.3697889190232621637,
        -1.4515038174921830461});

    ASSERT_EQ(false, p.use_roots());

    for(unsigned i=0; i<100; ++i)
    {
        double ans = p(x[i]);
        ASSERT_NEAR(expect[i], ans, 1e-10);
    }
}

TEST(PolynomialEval, CoeffEvalArray)
{
    poly::Polynomial p({
        -0.4916218280996111911, -0.8982162617733904231, 0.7602088084916123201,
        -0.448439129531960301, 0.3545960195550776906, -0.3283898241480742719,
        0.4223789892087406184, -0.7103073755983877469, -0.3174457996772097612,
        0.5678907422064218835, 0.1017319946924333252, -0.5244753533101400578});

    basic::DArry x({
        -0.9716791891045937213, -0.9433930284794238563, -0.9285346054263321491,
        -0.9191397182627092377, -0.9157027296562816332, -0.898500881351468994 ,
        -0.8929698142612050304, -0.8658543285738298234, -0.847897629451069168 ,
        -0.8369684145024784971, -0.8190150600262362524, -0.8086860317274677801,
        -0.8028785086540657367, -0.7815357849476760599, -0.7297751701355084109,
        -0.7017546833783556703, -0.6050979157571889644, -0.5864113091735991823,
        -0.5854616115574120538, -0.5763231385482165958, -0.550982565276565639 ,
        -0.5484293822895196513, -0.5239294666950595758, -0.52271040960075843  ,
        -0.5209594989994210668, -0.5115653454454371918, -0.5061769492911230017,
        -0.4680558887398351686, -0.3514234374167519714, -0.292206542363799171 ,
        -0.2713101781213369534, -0.2610267067476770286, -0.246963041191359256 ,
        -0.2396068891679417057, -0.2115852514073548463, -0.2062164863301956252,
        -0.1795288265989700704, -0.1777880949384156306, -0.17204173366609532  ,
        -0.1640895549260288355, -0.1318854048193409678, -0.1105856171753487605,
        -0.0665137068668282261, -0.0601092627970079008, -0.0405274881966453115,
        -0.0345996065394731378, -0.0336030353860512498, -0.0268465010949860972,
        -0.0163496089306680581, -0.0030854627148424463,  0.0323466056905143962,
        0.0330141390602332052,  0.0484900535975290037,  0.0766940377157687703,
        0.0771149741561787394,  0.0883546814829068161,  0.1404273991451308046,
        0.1515555784187796462,  0.2157002647504653314,  0.3458730112580528093,
        0.3822846995618662813,  0.4023632606195630679,  0.4086336979887750243,
        0.4218642550348343789,  0.4934427320690681906,  0.5136950846603085541,
        0.5303347828052613622,  0.5352700834039478828,  0.5460565603036600102,
        0.5695242345638906745,  0.5743861793754032607,  0.5880763062326954671,
        0.5912906091507657003,  0.5993417674864114364,  0.6071473248420011792,
        0.6190650480213391038,  0.6526039510453802706,  0.657589754038739871 ,
        0.6601521832211765251,  0.6705655295638843771,  0.7015806157578881042,
        0.702016289223720058 ,  0.7119873570744936764,  0.7237036564974344   ,
        0.7293822198829045256,  0.7379276671174737068,  0.7379496340217694961,
        0.7381858238138130357,  0.7673473395688295007,  0.781437197166929387 ,
        0.7908435339730013336,  0.80350625163021272  ,  0.8153214816198517401,
        0.8548717869707775918,  0.8908864381188752457,  0.9203151386957315605,
        0.9232977159544399903,  0.9469237399574974567,  0.9712669939719409395,
        0.9885908947215498177});

    basic::DArry expect({
        2.8152080950040403451,  2.503031526316306099 ,  2.3541863437401095993,
        2.2649004228568356822,  2.2331201627814758481,  2.0807690507157827753,
        2.0340395815149339143,  1.819410808490801168 ,  1.6893169057565093905,
        1.6143766892149538084,  1.497688539980585265 ,  1.4339345721263085931,
        1.3991123244898677758,  1.2770935565935286338,  1.0155601887329379629,
        0.8914083986914540514,  0.53646856416665889  ,  0.4786410794658201295,
        0.4757818834630597182,  0.4486490161360618956,  0.3768515861215918639,
        0.3698851624236532132,  0.3053664125085201464,  0.3022624767867836404,
        0.2978213878918108959,  0.2743314790895118316,  0.2611096977549073328,
        0.1724843346484139506, -0.0542985325154361487, -0.1494060703997987516,
        -0.1803764287140802725, -0.1951644395481811345, -0.2149250890816554183,
        -0.2250540407445572044, -0.2623918850940754055, -0.2693281526496128508,
        -0.3028217500755164826, -0.3049509398421561546, -0.3119327422265886218,
        -0.3214772805899649422, -0.3587855478307607759, -0.3823294732853440014,
        -0.4283755488279765711, -0.4347816807922331717, -0.453939908370930234 ,
        -0.4596147282519900124, -0.4605631527589774121, -0.4669510895545481155,
        -0.4767311466947223852, -0.4888431648606307856, -0.5198954667706742194,
        -0.5204628151168144701, -0.533438165898329375 , -0.5562289555374462235,
        -0.5565609281020649224, -0.5653381289383850872, -0.603884217625596964 ,
        -0.6116866951102153394, -0.653857364220855608 , -0.7261779966223751437,
        -0.7436407874242593197, -0.7528307974286454485, -0.7556417043892360574,
        -0.7614859339921682402, -0.7914303655016394767, -0.7995509917860529336,
        -0.8061759981031171307, -0.8081385130258158522, -0.812431636715872818 ,
        -0.8218404586667125145, -0.823810799429267937 , -0.8294181613189255398,
        -0.8307498899050670405, -0.834115969632706511 , -0.8374264338353394344,
        -0.8425868437186154747, -0.858029068467168643 , -0.8604717961212631216,
        -0.8617448885551297622, -0.8670516003829764617, -0.8843708194080095453,
        -0.8846330096563130851, -0.8907998029826937891, -0.8984863518967065588,
        -0.9024000661008482194, -0.9085427474732965525, -0.9085589489072991576,
        -0.9087332850778911952, -0.9323877718896431688, -0.9455628915673015555,
        -0.9551055315509942023, -0.969009117169223666 , -0.983197365354386843 ,
        -1.0411003717020679282, -1.1119985585248977067, -1.1873694375621384189,
        -1.1960691479273006799, -1.2730701030408371199, -1.3697889190232621637,
        -1.4515038174921830461});

    basic::DArry ans = p(x);

    ASSERT_EQ(false, p.use_roots());

    for(unsigned i=0; i<100; ++i)
        ASSERT_NEAR(expect[i], ans[i], 1e-10);
}

TEST(PolynomialEval, RootsEvalOneValue)
{
    poly::Polynomial p(1.5, basic::DArry({
        -0.3669353910426638166, -0.0264745251641291812,  0.4774563453977860306,
        0.7232398896752869621, -0.5869059696877685361, -0.689995530137420765 ,
        -0.4359793598032364326, -0.8302874860082150033, -0.1174509733240964859}));

    basic::DArry x({
        -0.9716791891045937213, -0.9433930284794238563, -0.9285346054263321491,
        -0.9191397182627092377, -0.9157027296562816332, -0.898500881351468994 ,
        -0.8929698142612050304, -0.8658543285738298234, -0.847897629451069168 ,
        -0.8369684145024784971, -0.8190150600262362524, -0.8086860317274677801,
        -0.8028785086540657367, -0.7815357849476760599, -0.7297751701355084109,
        -0.7017546833783556703, -0.6050979157571889644, -0.5864113091735991823,
        -0.5854616115574120538, -0.5763231385482165958, -0.550982565276565639 ,
        -0.5484293822895196513, -0.5239294666950595758, -0.52271040960075843  ,
        -0.5209594989994210668, -0.5115653454454371918, -0.5061769492911230017,
        -0.4680558887398351686, -0.3514234374167519714, -0.292206542363799171 ,
        -0.2713101781213369534, -0.2610267067476770286, -0.246963041191359256 ,
        -0.2396068891679417057, -0.2115852514073548463, -0.2062164863301956252,
        -0.1795288265989700704, -0.1777880949384156306, -0.17204173366609532  ,
        -0.1640895549260288355, -0.1318854048193409678, -0.1105856171753487605,
        -0.0665137068668282261, -0.0601092627970079008, -0.0405274881966453115,
        -0.0345996065394731378, -0.0336030353860512498, -0.0268465010949860972,
        -0.0163496089306680581, -0.0030854627148424463,  0.0323466056905143962,
        0.0330141390602332052,  0.0484900535975290037,  0.0766940377157687703,
        0.0771149741561787394,  0.0883546814829068161,  0.1404273991451308046,
        0.1515555784187796462,  0.2157002647504653314,  0.3458730112580528093,
        0.3822846995618662813,  0.4023632606195630679,  0.4086336979887750243,
        0.4218642550348343789,  0.4934427320690681906,  0.5136950846603085541,
        0.5303347828052613622,  0.5352700834039478828,  0.5460565603036600102,
        0.5695242345638906745,  0.5743861793754032607,  0.5880763062326954671,
        0.5912906091507657003,  0.5993417674864114364,  0.6071473248420011792,
        0.6190650480213391038,  0.6526039510453802706,  0.657589754038739871 ,
        0.6601521832211765251,  0.6705655295638843771,  0.7015806157578881042,
        0.702016289223720058 ,  0.7119873570744936764,  0.7237036564974344   ,
        0.7293822198829045256,  0.7379276671174737068,  0.7379496340217694961,
        0.7381858238138130357,  0.7673473395688295007,  0.781437197166929387 ,
        0.7908435339730013336,  0.80350625163021272  ,  0.8153214816198517401,
        0.8548717869707775918,  0.8908864381188752457,  0.9203151386957315605,
        0.9232977159544399903,  0.9469237399574974567,  0.9712669939719409395,
        0.9885908947215498177});

    basic::DArry expect({
        -1.4768362675825683766e-02, -8.0393161869631510341e-03, -5.6446979262547158918e-03,
        -4.4436724687363779104e-03, -4.0569185140575383594e-03, -2.4840022129405557247e-03,
        -2.0898861558333163037e-03, -7.5269145254353551650e-04, -2.6945870892637678422e-04,
        -8.3020252479637784027e-05, 9.7480653960786586799e-05, 1.4960077396318746169e-04,
        1.6670503364315879908e-04, 1.7731754775675821496e-04, 6.9000718122829237831e-05,
        1.5362430359185076049e-05, -8.5258671920995597994e-06, 2.2641583871343311588e-07,
        6.5913098102291119412e-07, 4.6531520247384443919e-06, 1.3195881085245288926e-05,
        1.3793077160287296073e-05, 1.6757829474757396392e-05, 1.6775457771822470648e-05,
        1.6780106865375786474e-05, 1.6404015429042105101e-05, 1.5901658707045637255e-05,
        8.1068849316086701636e-06, 5.0870697058737099046e-06, 3.6895080832173011672e-05,
        4.8939594192983560176e-05, 5.4139081331930839129e-05, 5.9975288618225152250e-05,
        6.2290211245809393734e-05, 6.5201004687874249219e-05, 6.4544774258643863125e-05,
        5.4976615037500682029e-05, 5.3989769737438950245e-05, 5.0430769229898030374e-05,
        4.4775179232246656389e-05, 1.5076187767774963948e-05, -7.0367305729045323461e-06,
        -3.6149592796366839800e-05, -3.5905695501619732139e-05, -2.3205783230385000366e-05,
        -1.5054710324998075662e-05, -1.3458056701917147269e-05, -7.9398904038847852201e-07,
        2.5808860994248073177e-05, 7.3173882653117315426e-05, 2.9327351579080788730e-04,
        2.9893870176806943990e-04, 4.4822080478880009687e-04, 8.1702732246641588364e-04,
        8.2354985916132652721e-04, 1.0093651971634447738e-03, 2.1743817228116997867e-03,
        2.4877948889026574135e-03, 4.6416355331503535847e-03, 8.1383571453507511095e-03,
        7.6812531649665212116e-03, 6.9216059755319364263e-03, 6.5989451472174302446e-03,
        5.7747802190732467134e-03, -2.3686315084764861250e-03, -5.7824003403184843705e-03,
        -8.8767663326535101165e-03, -9.8336429625549542227e-03, -1.1969008472358173140e-02,
        -1.6686708906133246311e-02, -1.7648091486280454571e-02, -2.0256413328453827527e-02,
        -2.0838658012255407981e-02, -2.2227487370031540764e-02, -2.3456621498330370440e-02,
        -2.5041919713885800458e-02, -2.6578737782614506036e-02, -2.6292278140075626969e-02,
        -2.6079298295346987208e-02, -2.4705769291299101847e-02, -1.4496145926686396233e-02,
        -1.4272876029785802610e-02, -8.4343500097704467849e-03, 3.9364246302542587209e-04,
        5.5311222871760531983e-03, 1.4437818487045192203e-02, 1.4462640924856280666e-02,
        1.4730179991025349820e-02, 5.7976142062734437044e-02, 8.7429555622564755768e-02,
        1.1083173748685636040e-01, 1.4769106225927572384e-01, 1.8829409298836288778e-01,
        3.7804056779658712362e-01, 6.4538350085788442900e-01, 9.5418569397431696189e-01,
        9.9093325299080503576e-01, 1.3231236994391315509e+00, 1.7525787927382034947e+00,
        2.1216295692775721804e+00});

    ASSERT_EQ(true, p.use_roots());

    for(unsigned i=0; i<100; ++i)
    {
        double ans = p(x[i]);
        ASSERT_NEAR(expect[i], ans, 1e-10);
    }
}

TEST(PolynomialEval, RootsEvalArray)
{
    poly::Polynomial p(1.5, basic::DArry({
        -0.3669353910426638166, -0.0264745251641291812,  0.4774563453977860306,
        0.7232398896752869621, -0.5869059696877685361, -0.689995530137420765 ,
        -0.4359793598032364326, -0.8302874860082150033, -0.1174509733240964859}));

    basic::DArry x({
        -0.9716791891045937213, -0.9433930284794238563, -0.9285346054263321491,
        -0.9191397182627092377, -0.9157027296562816332, -0.898500881351468994 ,
        -0.8929698142612050304, -0.8658543285738298234, -0.847897629451069168 ,
        -0.8369684145024784971, -0.8190150600262362524, -0.8086860317274677801,
        -0.8028785086540657367, -0.7815357849476760599, -0.7297751701355084109,
        -0.7017546833783556703, -0.6050979157571889644, -0.5864113091735991823,
        -0.5854616115574120538, -0.5763231385482165958, -0.550982565276565639 ,
        -0.5484293822895196513, -0.5239294666950595758, -0.52271040960075843  ,
        -0.5209594989994210668, -0.5115653454454371918, -0.5061769492911230017,
        -0.4680558887398351686, -0.3514234374167519714, -0.292206542363799171 ,
        -0.2713101781213369534, -0.2610267067476770286, -0.246963041191359256 ,
        -0.2396068891679417057, -0.2115852514073548463, -0.2062164863301956252,
        -0.1795288265989700704, -0.1777880949384156306, -0.17204173366609532  ,
        -0.1640895549260288355, -0.1318854048193409678, -0.1105856171753487605,
        -0.0665137068668282261, -0.0601092627970079008, -0.0405274881966453115,
        -0.0345996065394731378, -0.0336030353860512498, -0.0268465010949860972,
        -0.0163496089306680581, -0.0030854627148424463,  0.0323466056905143962,
        0.0330141390602332052,  0.0484900535975290037,  0.0766940377157687703,
        0.0771149741561787394,  0.0883546814829068161,  0.1404273991451308046,
        0.1515555784187796462,  0.2157002647504653314,  0.3458730112580528093,
        0.3822846995618662813,  0.4023632606195630679,  0.4086336979887750243,
        0.4218642550348343789,  0.4934427320690681906,  0.5136950846603085541,
        0.5303347828052613622,  0.5352700834039478828,  0.5460565603036600102,
        0.5695242345638906745,  0.5743861793754032607,  0.5880763062326954671,
        0.5912906091507657003,  0.5993417674864114364,  0.6071473248420011792,
        0.6190650480213391038,  0.6526039510453802706,  0.657589754038739871 ,
        0.6601521832211765251,  0.6705655295638843771,  0.7015806157578881042,
        0.702016289223720058 ,  0.7119873570744936764,  0.7237036564974344   ,
        0.7293822198829045256,  0.7379276671174737068,  0.7379496340217694961,
        0.7381858238138130357,  0.7673473395688295007,  0.781437197166929387 ,
        0.7908435339730013336,  0.80350625163021272  ,  0.8153214816198517401,
        0.8548717869707775918,  0.8908864381188752457,  0.9203151386957315605,
        0.9232977159544399903,  0.9469237399574974567,  0.9712669939719409395,
        0.9885908947215498177});

    basic::DArry expect({
        -1.4768362675825683766e-02, -8.0393161869631510341e-03, -5.6446979262547158918e-03,
        -4.4436724687363779104e-03, -4.0569185140575383594e-03, -2.4840022129405557247e-03,
        -2.0898861558333163037e-03, -7.5269145254353551650e-04, -2.6945870892637678422e-04,
        -8.3020252479637784027e-05, 9.7480653960786586799e-05, 1.4960077396318746169e-04,
        1.6670503364315879908e-04, 1.7731754775675821496e-04, 6.9000718122829237831e-05,
        1.5362430359185076049e-05, -8.5258671920995597994e-06, 2.2641583871343311588e-07,
        6.5913098102291119412e-07, 4.6531520247384443919e-06, 1.3195881085245288926e-05,
        1.3793077160287296073e-05, 1.6757829474757396392e-05, 1.6775457771822470648e-05,
        1.6780106865375786474e-05, 1.6404015429042105101e-05, 1.5901658707045637255e-05,
        8.1068849316086701636e-06, 5.0870697058737099046e-06, 3.6895080832173011672e-05,
        4.8939594192983560176e-05, 5.4139081331930839129e-05, 5.9975288618225152250e-05,
        6.2290211245809393734e-05, 6.5201004687874249219e-05, 6.4544774258643863125e-05,
        5.4976615037500682029e-05, 5.3989769737438950245e-05, 5.0430769229898030374e-05,
        4.4775179232246656389e-05, 1.5076187767774963948e-05, -7.0367305729045323461e-06,
        -3.6149592796366839800e-05, -3.5905695501619732139e-05, -2.3205783230385000366e-05,
        -1.5054710324998075662e-05, -1.3458056701917147269e-05, -7.9398904038847852201e-07,
        2.5808860994248073177e-05, 7.3173882653117315426e-05, 2.9327351579080788730e-04,
        2.9893870176806943990e-04, 4.4822080478880009687e-04, 8.1702732246641588364e-04,
        8.2354985916132652721e-04, 1.0093651971634447738e-03, 2.1743817228116997867e-03,
        2.4877948889026574135e-03, 4.6416355331503535847e-03, 8.1383571453507511095e-03,
        7.6812531649665212116e-03, 6.9216059755319364263e-03, 6.5989451472174302446e-03,
        5.7747802190732467134e-03, -2.3686315084764861250e-03, -5.7824003403184843705e-03,
        -8.8767663326535101165e-03, -9.8336429625549542227e-03, -1.1969008472358173140e-02,
        -1.6686708906133246311e-02, -1.7648091486280454571e-02, -2.0256413328453827527e-02,
        -2.0838658012255407981e-02, -2.2227487370031540764e-02, -2.3456621498330370440e-02,
        -2.5041919713885800458e-02, -2.6578737782614506036e-02, -2.6292278140075626969e-02,
        -2.6079298295346987208e-02, -2.4705769291299101847e-02, -1.4496145926686396233e-02,
        -1.4272876029785802610e-02, -8.4343500097704467849e-03, 3.9364246302542587209e-04,
        5.5311222871760531983e-03, 1.4437818487045192203e-02, 1.4462640924856280666e-02,
        1.4730179991025349820e-02, 5.7976142062734437044e-02, 8.7429555622564755768e-02,
        1.1083173748685636040e-01, 1.4769106225927572384e-01, 1.8829409298836288778e-01,
        3.7804056779658712362e-01, 6.4538350085788442900e-01, 9.5418569397431696189e-01,
        9.9093325299080503576e-01, 1.3231236994391315509e+00, 1.7525787927382034947e+00,
        2.1216295692775721804e+00});

    basic::DArry ans = p(x);

    ASSERT_EQ(true, p.use_roots());

    for(unsigned i=0; i<100; ++i)
        ASSERT_NEAR(expect[i], ans[i], 1e-10);
}
